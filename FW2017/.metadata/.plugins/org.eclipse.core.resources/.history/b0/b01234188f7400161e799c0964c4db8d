//*****************************************************************************
//
// MSP432 main.c template - Empty main
//
//****************************************************************************

#include "msp.h"

#include "timer.hpp"
#include "TimerPWM_Servo.hpp"

using namespace Peripherials;

void ClearRed() {
	P2->OUT &= ~1;
}

void SetRed() {
	P2->OUT |= 1;
}

void ToggleGreen() {
	P2->OUT ^= 2;
}
#define scale 1000

void main(void) {

	WDTCTL = WDTPW | WDTHOLD;           // Stop watchdog timer

	P2->DIR = 0xFF;
	P2->SEL0 = 1 << 4;
	P2->OUT = 0;
	struct internal_servo_cal_point low = {0, 0.0005};
	struct internal_servo_cal_point high = {100, 0.0025};

	InternalServoControl servo = InternalServoControl(TA0, CC1, low, high);
	servo.Resume();
	int i;
	while (true) {
		for (i = 0; i < 100; i++) {
			servo.GoToAngle(i);
			__delay_cycles(480000);
		}
		servo.Suspend();
		__delay_cycles(48000000);
		servo.Resume();
		for (i = 100; i > 0; i--) {
			servo.GoToAngle(i);
			__delay_cycles(480000);
		}
	}
}
