//*****************************************************************************
//
// MSP432 main.c template - Empty main
//
//****************************************************************************

#include "msp.h"

#include "timer.hpp"

using namespace Peripherials;

void ToggleRed() {
	P2->OUT ^= 0xFF;
}

void main(void) {

	WDTCTL = WDTPW | WDTHOLD;           // Stop watchdog timer

	P2->DIR = 0xFF;
	P2->SEL0 = 1 << 4;
	P2->OUT = 0;
	TA0.AttachInterrupt(CC0, ToggleRed);
	__enable_irq();
	TA0.SetPeriod((uint16_t)0xFFFF);
	uint16_t ledTime;
	TA0.StartPWM(CC1, (uint16_t)0x7FFF);
	while (true) {
		for (ledTime = 0; ledTime < 0xFFFF; ledTime += 0x1000) {
			TA0.SetPWM(CC1, (uint16_t)ledTime);
			__delay_cycles(4800000);
		}
	for (ledTime = 0xFFFF; ledTime > 0x0000; ledTime -= 0x1000) {
		TA0.SetPWM(CC1, (uint16_t)ledTime);
		__delay_cycles(4800000);
	}
}
}
